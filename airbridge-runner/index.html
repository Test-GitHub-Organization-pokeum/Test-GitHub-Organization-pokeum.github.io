<!DOCTYPE html>
<html>

<head>
    <title>Airbridge Runner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="container">
        <h1>Airbridge Runner</h1>

        <div class="grid-2">
            <div class="input-group">
                <label for="nativeName">AirbridgeNative Object Name</label>
                <input type="text" id="nativeName" value="AirbridgeNative" />
            </div>

            <div class="input-group">
                <label for="typeInput">Type</label>
                <select id="typeInput">
                    <option value="" selected disabled>Select a type</option>
                    <option value="setUserID">setUserID</option>
                    <option value="clearUserID">clearUserID</option>
                    <option value="setUserEmail">setUserEmail</option>
                    <option value="clearUserEmail">clearUserEmail</option>
                    <option value="setUserPhone">setUserPhone</option>
                    <option value="clearUserPhone">clearUserPhone</option>
                    <option value="setUserAttribute">setUserAttribute</option>
                    <option value="removeUserAttribute">removeUserAttribute</option>
                    <option value="clearUserAttributes">clearUserAttributes</option>
                    <option value="setUserAlias">setUserAlias</option>
                    <option value="removeUserAlias">removeUserAlias</option>
                    <option value="clearUserAlias">clearUserAlias</option>
                    <option value="clearUser">clearUser</option>
                    <option value="setDeviceAlias">setDeviceAlias</option>
                    <option value="removeDeviceAlias">removeDeviceAlias</option>
                    <option value="clearDeviceAlias">clearDeviceAlias</option>
                    <option value="trackEvent">trackEvent</option>
                    <option value="ack">ack</option>
                </select>
            </div>
        </div>

        <div class="input-group">
            <label for="parameterInput">Parameter (JSON)</label>
            <textarea id="parameterInput" placeholder='{"foo":"bar"}'></textarea>
        </div>

        <button id="btnExecute">Execute Command</button>
        <button id="btnGetWebToken" class="secondary">Get Web Token</button>
        <button id="btnGetJSONSchemaVersion" class="secondary">Get JSON Schema Version</button>
    </div>

    <script type="text/javascript">
        // Button references
        const btnExecute = document.getElementById("btnExecute");
        const btnGetWebToken = document.getElementById("btnGetWebToken");
        const btnGetJSONSchemaVersion = document.getElementById("btnGetJSONSchemaVersion");

        // Input references
        const nativeNameInput = document.getElementById("nativeName");
        const typeInput = document.getElementById("typeInput");
        const parameterInput = document.getElementById("parameterInput");

        // Helper: Get the AirbridgeNative object
        function getNativeObject() {
            const name = nativeNameInput.value.trim();
            if (!name) {
                alert("Please enter the object name.");
                return null;
            }

            const obj = window[name];
            if (!obj) {
                alert(`Could not find object "${name}".`);
                return null;
            }
            return obj;
        }

        // Execute button click
        btnExecute.addEventListener("click", function () {
            const type = typeInput.value.trim();
            const parameterText = parameterInput.value.trim();

            if (!type) {
                alert("Please enter a type.");
                return;
            }

            let parameter = {};
            if (parameterText) {
                try {
                    parameter = JSON.parse(parameterText);
                } catch (e) {
                    alert("Invalid JSON in parameter: " + e.message);
                    return;
                }
            }

            const obj = getNativeObject();
            if (!obj) return;

            const payload = {
                type: type,
                parameter: parameter
            };

            console.log("Executing:", payload);
            obj.execute(JSON.stringify(payload));
            alert("Command sent:\n" + JSON.stringify(payload, null, 2));
        });

        // getWebToken()
        btnGetWebToken.addEventListener("click", function () {
            const obj = getNativeObject();
            if (!obj) return;
            const token = obj.getWebToken();
            alert("getWebToken(): " + token);
        });

        // getJSONSchemaVersion()
        btnGetJSONSchemaVersion.addEventListener("click", function () {
            const obj = getNativeObject();
            if (!obj) return;
            const version = obj.getJSONSchemaVersion();
            alert("getJSONSchemaVersion(): " + version);
        });
    </script>

</body>

</html>